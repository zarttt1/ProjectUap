<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Barang - Investo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 shadow">
      <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-xl font-bold">Investo - Data Barang</h1>
        <nav>
          <a href="index.html" class="ml-4 hover:underline">Dashboard</a>
          <a href="barang.html" class="ml-4 hover:underline font-bold"
            >Barang</a
          >
          <a href="kategori.html" class="ml-4 hover:underline">Kategori</a>
          <a href="pemasok.html" class="ml-4 hover:underline">Pemasok</a>
          <a href="transaksi.html" class="ml-4 hover:underline">Transaksi</a>
          <a href="pengguna.html" class="ml-4 hover:underline">Pengguna</a>
          <a href="logout.html" class="ml-4 hover:underline">Logout</a>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto py-10 px-4">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Manajemen Barang</h2>
        <button
          class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
          onclick="openModal('tambah')"
        >
          + Tambah Barang
        </button>
      </div>

      <div class="bg-white shadow rounded-lg overflow-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-200">
            <tr>
              <th class="py-3 px-4 text-left">Kode</th>
              <th class="py-3 px-4 text-left">Nama</th>
              <th class="py-3 px-4 text-left">Kategori</th>
              <th class="py-3 px-4 text-left">Stok</th>
              <th class="py-3 px-4 text-left">Harga</th>
              <th class="py-3 px-4 text-left">Aksi</th>
            </tr>
          </thead>
          <tbody id="tabel-barang">
            <!-- Data akan diisi otomatis dengan fetch() -->
          </tbody>
        </table>
      </div>
    </main>

    <!-- Modal Tambah/Edit Barang -->
    <div
      id="modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white w-full max-w-md p-6 rounded shadow-lg">
        <h3 id="modal-title" class="text-xl font-semibold mb-4">
          Tambah Barang
        </h3>
        <form id="barang-form">
          <input type="hidden" id="mode-edit" value="false" />
          <div class="mb-3">
            <label class="block mb-1">Kode Barang</label>
            <input
              type="text"
              id="kode"
              name="kode"
              class="w-full border px-3 py-2 rounded"
              required
            />
          </div>
          <div class="mb-3">
            <label class="block mb-1">Nama Barang</label>
            <input
              type="text"
              id="nama"
              name="nama"
              class="w-full border px-3 py-2 rounded"
              required
            />
          </div>
          <div class="mb-3">
            <label class="block mb-1">Kategori</label>
            <select
              id="kategori"
              name="kategori"
              class="w-full border px-3 py-2 rounded"
              required
            >
              <option value="">-- Pilih Kategori --</option>
              <option value="Elektronik">Elektronik</option>
              <option value="Pakaian">Pakaian</option>
              <option value="Alat Tulis">Alat Tulis</option>
              <option value="Makanan">Makanan</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="block mb-1">Stok</label>
            <input
              type="number"
              id="stok"
              name="stok"
              class="w-full border px-3 py-2 rounded"
              required
            />
          </div>
          <div class="mb-3">
            <label class="block mb-1">Harga</label>
            <input
              type="number"
              id="harga"
              name="harga"
              class="w-full border px-3 py-2 rounded"
              required
            />
          </div>

          <div class="flex justify-end space-x-2">
            <button
              type="button"
              onclick="closeModal()"
              class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"
            >
              Batal
            </button>
            <button
              type="submit"
              class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            >
              Simpan
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", loadBarang);
      const form = document.getElementById("barang-form");

      function loadBarang() {
        fetch("list_barang.php")
          .then((res) => res.json())
          .then((data) => {
            const tbody = document.getElementById("tabel-barang");
            tbody.innerHTML = "";
            data.forEach((b) => {
              tbody.innerHTML += `
              <tr class="border-t">
                <td class="py-2 px-4">${b.kode}</td>
                <td class="py-2 px-4">${b.nama}</td>
                <td class="py-2 px-4">${b.kategori}</td>
                <td class="py-2 px-4">${b.stok}</td>
                <td class="py-2 px-4">Rp ${b.harga.toLocaleString()}</td>
                <td class="py-2 px-4 space-x-2">
                  <button class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600" onclick="editBarang('${
                    b.kode
                  }')">Edit</button>
                  <button class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700" onclick="hapusBarang('${
                    b.kode
                  }')">Hapus</button>
                </td>
              </tr>`;
            });
          });
      }

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const isEdit = document.getElementById("mode-edit").value === "true";
        const url = isEdit ? "edit_barang.php" : "tambah_barang.php";
        const formData = new FormData(form);

        fetch(url, { method: "POST", body: formData }).then(() => {
          loadBarang();
          closeModal();
        });
      });

      function openModal(mode) {
        document.getElementById("modal").classList.remove("hidden");
        if (mode === "tambah") {
          document.getElementById("modal-title").innerText = "Tambah Barang";
          form.reset();
          document.getElementById("mode-edit").value = "false";
          document.getElementById("kode").removeAttribute("readonly");
        }
      }

      function closeModal() {
        document.getElementById("modal").classList.add("hidden");
      }

      function editBarang(kode) {
        fetch("list_barang.php")
          .then((res) => res.json())
          .then((data) => {
            const barang = data.find((b) => b.kode === kode);
            openModal("edit");
            document.getElementById("modal-title").innerText = "Edit Barang";
            document.getElementById("kode").value = barang.kode;
            document.getElementById("kode").setAttribute("readonly", true);
            document.getElementById("nama").value = barang.nama;
            document.getElementById("kategori").value = barang.kategori;
            document.getElementById("stok").value = barang.stok;
            document.getElementById("harga").value = barang.harga;
            document.getElementById("mode-edit").value = "true";
          });
      }

      function hapusBarang(kode) {
        if (confirm("Yakin hapus barang ini?")) {
          fetch(`hapus_barang.php?kode=${kode}`).then(() => loadBarang());
        }
      }
    </script>
  </body>
</html>
